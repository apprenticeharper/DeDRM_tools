name: Package plugin
on:
  push:
    branches: [ master ]

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Package
        run: python3 make_release.py

      - name: Upload
        uses: actions/upload-artifact@v2
        with: 
          name: plugin
          path: |
            DeDRM_tools_*.zip
            DeDRM_tools.zip

#      - name: Delete old release
#        uses: cb80/delrel@latest
#        with:
#          tag: autorelease
#          token: ${{ github.token }}
#
#      - name: Delete old tag
#        uses: dev-drprasad/delete-tag-and-release@v1.0
#        with:
#          tag_name: autorelease
#          github_token: ${{ github.token }}
#          delete_release: true
#      
#      - name: Prepare release
#        run: cp DeDRM_tools.zip DeDRM_alpha_${{ github.sha }}.zip
#
#      - name: Auto-release
#        id: autorelease
#        uses: softprops/action-gh-release@v1
#        with: 
#          tag_name: autorelease
#          token: ${{ github.token }}
#          name: Automatic alpha release with latest changes
#          body: |
#            This release is automatically generated by Github for each commit. 
#
#            This means, every time a change is made to this repo, this release will be updated to contain an untested copy of the plugin at that stage. This will contain the most up-to-date code, but it's not tested at all and may be broken.
#
#            Last update based on Git commit ${{ github.sha }}.
#          prerelease: true
#          draft: true
#          files: DeDRM_alpha_${{ github.sha }}.zip
#
#      - name: Make release public
#        uses: irongut/EditRelease@v1.2.0
#        with:
#          token: ${{ github.token }}
#          id: ${{ steps.autorelease.outputs.id }}
#          draft: false
#          prerelease: true
#
#